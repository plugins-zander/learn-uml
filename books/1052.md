# 简介

顺序图按照时间顺序描述了对象间的交互，但是它过于强调交互的时间，而削弱了对象之间的静态连接关系的重视。协作图则强调了参与交互作用的对象的组织。 



协作图（Collaboration Diagram）是用于描述系统的行为，是如何由系统成分协作实现的图。所谓协作是指在一定的语境中一组对象以及用以实现某些行为的这些对象间的相互作用。它描述了这样一组对象为实现某种目的而组成相互合作的“对象社会”。协作图可以表示类操作的实现。 



协作图是一种交互图，强调的是发送和接收消息的对象之间的组织结构，使用协作图来说明系统的动态情况。协作图主要描述协作对象间的交互和链接，显示对象、对象间的链接以及对象间如何发送消息，它表示了协作中作为各种类元角色的对象所处的位置，在图中主要显示了类元角色和关联角色。在UML的表示中，协作图将类元角色表示为类的符号（矩形），将关联角色表现为实线的关联路径，关联路径上带有消息符号。 





协作图强调参与一个交互对象的组织，它由以下基本元素组成：活动者、对象、连接和消息。 



## 协作图的基本内容



```
⑴活动者
活动者（Actor）发出主动操作的对象，负责发送初始消息，启动一个操作。
⑵对象
对象（Object）是类的实例，负责发送和接收消息.一个协作代表了为了完成某个目标而共同工作的一组对象。对象的角色表示一个或一组对象在完成目标的过程中所应该起的作用。协作图中的对象与顺序图中的对象元素概念基本相同，表示方式也相同，只不过没有生命线，而且在协作图中，无法表示对象的创建和撤销，所以对象在协作图中的位置没有限制。
⑶链接
链接（Link）用线条来表示链接，链接表示两个对象共享一个消息，位于对象之间或参与者与对象之间。
⑷消息
消息（Message）的含义与顺序图中的消息基本类似。在协作图中，不带有消息的协作图标明了交互作用发生的上下文，而不表示交互。它可以用来表示单一操作的上下文，甚至可以表示一个或一组类中所有操作的上下文。如果关联线上标有消息，图形就可以表示一个交互。

```



![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191123221512.png)

图 6.26 成绩查询协作图 

利用消息可以完成很多任务，可以顺序执行、添加条件限制发送、创建带有消息的对象实例和执行迭代。 



```
① 序列化
序列化消息只需要在消息前添加序列号，默认情况下即可。这也是最简单的方式，消息会按照要执行的顺序排序，如图6.26所示。
② 控制点条件
控制点条件用来根据消息表达式的计算结果来限制消息的发送。控制点包含在消息中，在序列ID号和消息文本之间。 

```





```
例如，如果B计算结果为真，那么ObjectA将会把消息operator1发送给ObjectB；如果C计算结果为真，那么ObjectA将会把消息operator2发送给ObjectC;其他条件下不会发送任何消息，如图6.27所示。 

```



![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191123221742.png)

图6.27  控制点条件 





```
③ 创建实例 
就像在顺序图中看到的一样，消息也可以用来在协作图中创建对象实例。为此，一个消息将会发送到新创建的对象实例。对象使用“new”构造类型，消息使用“create”构造类型，以便让读者清楚对象是在运行中创建的，如图6.28所示。 

```



![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191123221808.png)



图6.28  创建实例 



```
④发送给多对象的消息
一个对象可能会向同一个类的多个对象同时发送一个消息。在协作图中，多对象（Multiple Object）用“一叠向后延伸的多个对象图标”表示。在多对象前面可以加上用“[]”括起来的条件，前面加一个“*”，用来说明消息发送给多个对象，如图6.29所示。 

```

![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191123221838.png)

图6.29  多对象 

```
有时，按顺序发送消息是很重要的。例如，银行出纳员（bank clerk）要按照顾客排队的次序为排名顾客（customer ）服务。可以用“while”条件表达出消息的顺序（例如“line position=l...n”) ，参见图6.30。 

```



![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191123221902.png)

图6.30  一个对象以指定的次序向多对象发送消息 



```
⑤ 返回结果
消息可能是要求某个对象进行计算并返回结果的值。例如一个顾客对象可能请求一个计算器（calculator）对象计算某项商品的总价，包括该项商品的价格和税款。
UML提供了返回值的表示法。返回值的名字在最左，后跟赋值号“: =”，接着是操作名和操作的参数。对计算商品价格这个例子，可以表示成：totalPrice : = compute(itemPrice, salesTax）。图6.31说明了在协作图中的返回值的表示法。
表达式中赋值号的右边部分被称为消息型构（message signature)。 

```

![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191123221926.png)

图6.31  一个包含返回值表示法的协作图 



```
⑥ 构造型
构造型（stereotype）可以在现有的UML元素的基础上创建新的元素。构造型用两对尖括号括起来的一个名称来表示，这个括号叫做双尖括号（guillemets）。这个被括起来的名称叫做关键字（keyword）。
有时侯，UML会创建新的模型。这时，UML并不是为某事物创建一个全新的符号，而是把一个关键字添加到已有的元素中。这个关键字表明了该元素的用法与其原来的意图多少有些不同。接口（interface）是一个没有属性而只有操作的类，它是使用构造型的一个例子，它是可以在整个模型中反复使用的一组行为。无须发明一个新的UML元素来表示接口，UML可以在类图标中类名的上面加一个<<Interface>>关键字来表示接口，如图6.32所示。 

```



![](https://raw.githubusercontent.com/ZanderZhao/images/master/img2019/20191123221953.png)

图6.32  UML2.0接口 



构造型的概念在使用UML建模工具的时侯很有用。建模工具的一个重要特点是具备“字典”的功能，能够跟踪在模型中创建的所有的元素，包括类、用例、构件等等。字典只能够对已有的元素和基于这些元素的构造型有效。因此，构造型允许创建一些新的东西并把它们存储到字典中。 





## 协作图建模技术及应用



对系统动态行为建模，当按组织对控制流建模时，一般使用协作图，与顺序图一样，一个单独的协作图只能显示一个控制流。 

```
使用协作图建模时可以遵循如下策略：
⑴确定交互过程的上下文；
⑵确定参与交互过程的活动者与对象；
⑶如果需要，为每个对象设置初始特性；
⑷确定活动者、对象之间的链接。一般先确定关联的链接，因为这是最主要的，它代表了结构的链接。然后需要确定其他链接，用合适的路径构造型修饰，这表达了对象间是如何互相联系的。
⑸从引发该交互过程的初始消息开始，将每个消息附到相应的链接上，可以用带小数点的编号来表达嵌套；
⑹细化消息内容。比如需要说明时间或空间的约束，可以用适当的时间或空间约束来修饰每个消息。 

```



```
从面向对象的角度来看，系统的功能是由一组对象通过相互发送消息来完成的，顺序图和协作图就是通过描述这样的对象和消息来描述系统的动态行为的。协作图和顺序图作为交互图都表示出了对象间的交互作用，两者都直观地规定了发送对象和接受对象的责任，并且都支持所有的消息类型，在耦合性上两者都可以作为衡量的工具。两者在语义上是等价的，他们之间可以进行相互转换。多数的UML工具支持顺序图与协作图之间的相互转换，而不丢失任何信息。也就是只要设计出其中一种图就可以转换成另外一种图。 

```



```
UML顺序图将交互关系表示为一个二维图。纵轴是一个时间轴，时间炎竖线向下延伸。横向轴代表了在协作中各个独立对象的类元角色。类元角色都具有生命线。在对象交互的表示中加入了时间维。在顺序图中，对象位于图的顶部，从上到下表示时间的流逝。每个对象都有一个垂直向下的对象生命线。消息用连接对象生命线之间的带箭头连线代表。
顺序图可供不同种类的用户使用，用户可以从顺序图中看到业务过程的细节；分析人员可以从顺序图中看到处理流程；开发人员可以看到需要开发的对象和对这些对象的操作；软件测试工程师可以看到过程的细节，并根据这个过程开发测试案例。
协作图是表达顺序图中所有信息的另一种UML 图。协作图和顺序图是语义等价的。尽管如此，这两种图在建立系统的模型时都很有用。顺序图是按照时间组织，协作图是按照对象之间的联系组织。 

```











