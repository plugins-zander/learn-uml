# 简介

在标识出系统的类图之后，仅给出了实现用例的组成结构，还需要描述这些类的对象是如何交互来实现用例功能的。即不但需要把用例图模型转化为类图模型，还要将它转化为交互图模型。交互图表示类（对象）如何交互来实现系统行为。交互图包括顺序图和协作图两种。

本节主要介绍顺序图的概念、基本组成机建模过程。

顺序图（sequence diagram）是强调消息时间顺序的交互图，它描述了对象之间传送消息的时间顺序，用于表示用例中的行为顺序。顺序图将交互关系表示为一个二维图。横向轴代表了在协作中各独立对象的类元角色。纵向轴是时间轴，时间沿竖线向下延伸。

顺序图主要用于按照交互发生的一系列顺序，显示对象之间的这些交互。很象类图，开发者一般认为顺序图只对他们有意义。然而，一个组织的业务人员会发现，顺序图显示不同的业务对象如何交互，对于交流当前业务如何进行很有用。除记录组织的当前事件外，一个业务级的顺序图能被当作一个需求文件使用，为实现一个未来系统传递需求。在项目的需求阶段，分析师能通过提供一个更加正式层次的表达，把用例带入下一层次。那种情况下，用例常常被细化为一个或者更多的顺序图。在UML图中，顺序图与用例图和类图之间关系如图6.1所示。 



![](https://img1.zlogs.net/20/20200117211333.png)

图6.1  顺序图与用例图和类图之间关系图 

## 顺序图的基本内容

顺序图中包括的建模元素主要有：角色（Actor）、对象（Object）、生命线（Lifeline）、激活（Activation）、消息（Message）等。

1. 角色

   系统角色（Actor）可以是人或其他的系统或者其子系统。 

2. 对象

   顺序图中的对象（Object）在概念上和它在类图中的定义是一致的，它们之间可以进行交互，交互的顺序按时间的顺序。在顺序图中对象用矩形框表示，对象名带有下划线。

   对象的左右顺序并不重要，但是为了图的清晰整洁，通常应遵循以下原则： 

3. 生命线

4. 激活期

生命线（LiftLine）代表顺序图中对象在一段时间内的存在。生命线在顺序图中表示为从对象图标底部中心位置向下延伸的一条虚线（但事实上UML2中定义的生命线可以用实线来表示）。
激活期（Activation）也被称为控制焦点，代表顺序图中的对象执行一项操作的时期，是顺序图中表示时间段的符号，在这个时间段内对象将执行相应的操作。在UML中，用小矩形表示，被称为激活条或控制期，对象就是在激活条的顶部被激活的，在完成自己的工作后被去激活。 

5. 消息

消息（Message）是对象之间某种形式的通信，在垂直生命线之间，用带有箭头的线并附以消息表达式方式表示。它可以激发某个操作、唤起信号或导致目标对象的创建或撤销。一个对象到另一个对象的消息用跨越对象生命线的消息线表示。对象还可以发送消息给它自己，即消息线从自己的生命线出发又回到自己的生命线。 


在UML中，消息的箭头形状代表了消息的类型。消息的类型分为同步消息，异步消息和同步且立即返回消息三种。 

① 同步消息（Synchronous Message）

仅当发送者要发送一个消息而且接收者已经做好接收这个消息的准备时才能传送的消息称为同步消息，即发送者和接收者同步。

UML用一个带有实心箭头的实线来表示这种类型的消息，如图6.6所示。 
![](https://img1.zlogs.net/20/20200117211334.png)

图6.6  同步消息符号 
同步消息最常见的情况是调用，即消息发送者对象在它的一个操作执行时调用接收者对象的一个操作，此时消息名称就是被调用的操作名称。
假定有如下一个顺序图，如图6.7所示。 
![](https://img1.zlogs.net/20/20200117211335.png)
图6.7  顺序图实例 


则可能的情形为ClassA具有类型为ClassB的属性，类ClassB具有action1的方法及类型为ClassC的属性；类ClassC具有action2和action3的方法。类ClassC和ClassB的定义片段如下： 


```java
class ClassC{
public void action2()
{	
}
public void action3()
{
}
}
public  class ClassB
{
	private ClassC C=new ClassC();
	public void action1()
	{
	C.action2();
	C.action3();
	}
} 
```
注：在图中显示的消息可以带有参数，但本部分采用StarUML开发工具，其参数不显示出来，而是放在属性窗口的Arguments中。同样的，消息也可以有返回值，放在Return属性中。 


② 异步消息（Asynchronous Message）

发送者不管接收者是否做好了接收准备都可以发送的消息称为异步消息。消息发送者通过消息把信号传递给消息的接收者，然后继续自己的活动，不等待接受者返回消息或者控制。异步消息的接收者和发送者是并发工作的。 

![](https://img1.zlogs.net/20/20200117211336.png)

图6.8  异步消息符号 

③返回消息（Return Message）

返回消息表示从过程调用返回。 

![](https://img1.zlogs.net/20/20200117211337.png)

图6.9  返回消息图标 

另外在消息的创建过程中还存在一些其他的内容，比如说创建对象、撤销对象、自关联消息等。 

①创建（create）对象

一个对象可以通过发送消息来创建另一个对象，即创建对象，如图6.10所示。对象在创建消息发生后才能存在，对象的生命线也是在创建消息后才存在。

![](https://img1.zlogs.net/20/20200117211338.png)

图6.10  创建对象 



②撤销（destroy）对象

当一个对象被删除或自我删除时，该对象用“×”标记，即撤销对象，如图6.11所示。 

![](https://img1.zlogs.net/20/20200117211339.png)

图6.11  撤销对象 



③自关联消息（Self-Message）

表示方法的自身调用以及一个对象内的一个方法调用另外一个方法。如图6.12所示。 

![](https://img1.zlogs.net/20/20200117211340.png)

图6.12  自关联消息 



6.1.3  约  束 



当为对象的交互建模时，有时需要在某种条件满足时消息才会传递给对象。约束在UML图中用作控制流。一个约束只能被分配到一个单一消息。UML1.x中，为了实现约束条件，需要在消息名前加入约束条件，并放于“[]”中。约束条件用于描述代码中if语句结构。

例如，若b=1调用类Object2的message1方法；若b=2则调用类Object3的message2方法，如图6.13所示。 



![](https://img1.zlogs.net/20/20200117211341.png)

图6.13  条件约束 



在实际创建中需要将Combined Fragment组件放在顺序图中，然后在其属性窗口的InteractionOperator属性中选择对应的符号即可。例如循环片段的一个实例，如图6.15所示。 



![](https://img1.zlogs.net/20/20200117211342.png)

图6.15  循环片段 



```
使用顺序图对系统建模时，可以遵循如下策略：
（1）设置交互语境，这些语境可以是系统、子系统、操作、类、用例和协作的一个脚本；
（2）通过识别对象在交互中扮演的角色，根据对象的重要性，将其从左向右的方向放置在顺序图中。
（3）设置每个对象的生命线。一般情况下对象存在于交互的整个过程，但它可以在交互过程中创建和撤销；
（4）从引发某个交互的信息开始，在生命线之间从上向下的顺序画出随后的信息；
（5）设置对象的激活期，这可以可视化实际计算发生时的时间点、可视化消息嵌套等；
（6）如果需要设置时间或空间约束，可以为每个消息附上合适的约束；
（7）给控制流的每个消息附上前置或后置条件，这可以更详细的说明这个控制流。 

```

```
根据以上策略，画顺序图的一般步骤是：
（1）确定交互的范围
（2）确定参与交互过程的活动者与对象
（3）确定活动者、对象的生存周期
（4）确定交互中产生的消息
（5）细化消息的内容 

```









